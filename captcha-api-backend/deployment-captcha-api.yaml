apiVersion: apps/v1
kind: Deployment
metadata:
    name: captcha-api-backend
    namespace: captcha
spec:
    replicas: 2
    selector:
        matchLabels:
            app: captcha-api-backend
    template:
        metadata:
            labels:
                app: captcha-api-backend
        spec:
            nodeSelector:
                node-type: captcha-api
            imagePullSecrets:
                - name: kcr-pull-secret
            containers:
                - name: captcha-api-backend
                  image: kc-sfacspace.kr-central-2.kcr.dev/team1-repo/captcha-api-backend:14332dbeb1d768dfb26d70e01286d526b89a594d
                  ports:
                      - containerPort: 80
                  env:
                    - name: DB_HOST
                      value: "az-a.team1-db.1bb3c9ceb1db43928600b93b2a2b1d50.mysql.managed-service.kr-central-2.kakaocloud.com"
                    - name: DB_PORT
                      value: "13306"
                    - name: DB_USER
                      value: "realcatcha"
                    - name: DB_PASSWORD
                      value: "realcatcha"
                    - name: DB_NAME
                      value: "captcha"
                    - name: TZ
                      value: "Asia/Seoul"
                  resources:
                    requests:
                      memory: "2Gi"
                      cpu: "1"
                    limits:
                      memory: "4Gi"
                      cpu: "2"
                  livenessProbe:
                    httpGet:
                      path: /
                      port: 80
                    initialDelaySeconds: 30
                    periodSeconds: 10
                  readinessProbe:
                    httpGet:
                      path: /
                      port: 80
                    initialDelaySeconds: 5
                    periodSeconds: 5
